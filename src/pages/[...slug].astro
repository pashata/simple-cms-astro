---
import Layout from "../layouts/Layout.astro";
import DefaultTemplate from "../templates/Default.astro";
import Landing from "../templates/Landing.astro";
import BlogPost from "../templates/BlogPost.astro";
import { safeFetchRoutes } from "../utils/api/fetchRoutes";

const templateMap = {
  Landing,
  BlogPost,
  Default: DefaultTemplate,
} as const;

export async function getStaticPaths() {
  const routes = await safeFetchRoutes();

  return routes
    .filter(r => r.slug) // skip root
    .map(r => ({ params: { slug: r.slug }, props: { template: "Default" } }));
}

const { template } = Astro.props;
const Template = templateMap[template] ?? DefaultTemplate;
---
<Layout>
  <Template />
</Layout>
